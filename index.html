<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>3D Bilardo Top Kontrol</title>
<style>
  body { margin: 0; overflow: hidden; background: #0f662f; }
  #bilardoCanvas { display: block; }
  #powerBar {
    position: fixed;
    right: 10px;
    top: 50%;
    width: 30px;
    height: 200px;
    background: #333;
    border-radius: 10px;
  }
  #powerIndicator {
    position: absolute;
    bottom: 0;
    width: 100%;
    background: limegreen;
    border-radius: 10px;
  }
  #directionIndicator {
    position: fixed;
    left: 50%;
    bottom: 20px;
    width: 100px;
    height: 100px;
    margin-left: -50px;
    border: 2px solid white;
    border-radius: 50%;
  }
  #directionArrow {
    width: 4px;
    height: 50px;
    background: white;
    margin: 25px auto 0;
    transform-origin: bottom center;
  }
</style>
</head>
<body>
<canvas id="bilardoCanvas"></canvas>
<div id="powerBar"><div id="powerIndicator"></div></div>
<div id="directionIndicator">
  <div id="directionArrow"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
<script>
  // Sahne ve kamera
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0, 15, 25);
  camera.lookAt(0, 0, 0);

  // Renderer
  const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bilardoCanvas'), antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);

  // Işıklar
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(10, 20, 10);
  scene.add(light);

  const ambientLight = new THREE.AmbientLight(0x404040);
  scene.add(ambientLight);

  // Masa
  const masaGeo = new THREE.BoxGeometry(20, 1, 10);
  const masaMat = new THREE.MeshStandardMaterial({ color: 0x1c8c3a });
  const masa = new THREE.Mesh(masaGeo, masaMat);
  masa.position.y = -0.5;
  scene.add(masa);

  // Top
  const topGeo = new THREE.SphereGeometry(0.5, 32, 32);
  const topMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
  const bilardoTopu = new THREE.Mesh(topGeo, topMat);
  bilardoTopu.position.set(0, 0.5, 0);
  scene.add(bilardoTopu);

  // Hareket değişkenleri
  let velocity = new THREE.Vector3(0, 0, 0);
  let power = 0;
  let powerIncreasing = true;

  // Yön vektörü (x,z)
  let directionVector = new THREE.Vector3(0, 0, 0);

  // DOM elemanları
  const powerIndicator = document.getElementById('powerIndicator');
  const directionArrow = document.getElementById('directionArrow');

  // Klavye ile yön kontrolü
  const keys = { ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false };
  window.addEventListener('keydown', (e) => {
    if (e.key in keys) keys[e.key] = true;
    if (e.key === ' ') {
      // Vuruş: topa hız ver
      if (velocity.length() === 0 && directionVector.length() !== 0) {
        const normDir = directionVector.clone().normalize();
        velocity = normDir.multiplyScalar(power / 10);
      }
    }
  });
  window.addEventListener('keyup', (e) => {
    if (e.key in keys) keys[e.key] = false;
  });

  // Animasyon döngüsü
  function animate() {
    requestAnimationFrame(animate);

    // Güç animasyonu (top hareketsizse)
    if (velocity.length() === 0) {
      if (powerIncreasing) {
        power += 1;
        if (power >= 100) powerIncreasing = false;
      } else {
        power -= 1;
        if (power <= 0) powerIncreasing = true;
      }
      powerIndicator.style.height = power * 2 + '%';
    }

    // Yönü güncelle (top hareketsizse)
    if (velocity.length() === 0) {
      let dirX = 0;
      let dirZ = 0;
      if (keys.ArrowUp) dirZ -= 1;
      if (keys.ArrowDown) dirZ += 1;
      if (keys.ArrowLeft) dirX -= 1;
      if (keys.ArrowRight) dirX += 1;

      directionVector.set(dirX, 0, dirZ);
      if (directionVector.length() !== 0) {
        directionVector.normalize();
        // Yön oku döndür
        const angle = Math.atan2(directionVector.x, directionVector.z); // Z ekseni önde
        directionArrow.style.transform = `rotate(${angle}rad)`;
      }
    }

    // Topu hareket ettir
    if (velocity.length() !== 0) {
      bilardoTopu.position.add(velocity);

      // Masa sınırları
      if (bilardoTopu.position.x > 9.5) {
        bilardoTopu.position.x = 9.5;
        velocity.x = -velocity.x * 0.5;
      } else if (bilardoTopu.position.x < -9.5) {
        bilardoTopu.position.x = -9.5;
        velocity.x = -velocity.x * 0.5;
      }
      if (bilardoTopu.position.z > 4.5) {
        bilardoTopu.position.z = 4.5;
        velocity.z = -velocity.z * 0.5;
      } else if (bilardoTopu.position.z < -4.5) {
        bilardoTopu.position.z = -4.5;
        velocity.z = -velocity.z * 0.5;
      }

      // Sürtünme
      velocity.multiplyScalar(0.95);

      // Çok yavaşlarsa durdur
      if (velocity.length() < 0.01) {
        velocity.set(0, 0, 0);
      }
    }

    renderer.render(scene, camera);
  }

  animate();

  // Pencere boyutu değişirse
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>
</body>
</html>

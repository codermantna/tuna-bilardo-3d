<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>3D Bilardo - 8 Ball Pool Kontrollü</title>
  <style>
    body, html {
      margin: 0; padding: 0; overflow: hidden;
      background: #0f662f;
      font-family: Arial, sans-serif;
      user-select: none;
    }
    #bilardoCanvas {
      display: block;
      width: 100vw;
      height: 100vh;
      background-color: #0f662f;
    }
    #ui {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 150px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 10px;
      color: white;
      user-select: none;
    }
    #powerBar {
      position: relative;
      width: 20px;
      height: 100px;
      background: #333;
      border-radius: 10px;
      margin: 10px auto;
      overflow: hidden;
    }
    #powerIndicator {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 0;
      background: linear-gradient(to top, #ff4e4e, #ffbaba);
      border-radius: 10px 10px 0 0;
      transition: height 0.1s;
    }
    #directionIndicator {
      width: 100%;
      height: 20px;
      background: #222;
      margin-top: 15px;
      position: relative;
      border-radius: 5px;
    }
    #directionArrow {
      position: absolute;
      top: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 0; 
      height: 0; 
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 15px solid #ffeb3b;
      transition: left 0.1s;
    }
    #instructions {
      font-size: 12px;
      margin-top: 15px;
      color: #eee;
      line-height: 1.3;
    }
  </style>
</head>
<body>
  <canvas id="bilardoCanvas"></canvas>

  <div id="ui">
    <div>Güç</div>
    <div id="powerBar">
      <div id="powerIndicator"></div>
    </div>
    <div>Yön</div>
    <div id="directionIndicator">
      <div id="directionArrow"></div>
    </div>
    <div id="instructions">
      <b>Kontroller:</b><br>
      ← ve →: Yön değiştir<br>
      Boşluk: Vur
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
    // Sahne ve kamera
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0f662f);
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 30, 30);
    camera.lookAt(0, 0, 0);

    // Renderer
    const renderer = new THREE.WebGLRenderer({canvas: document.getElementById('bilardoCanvas'), antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);

    // Işıklar
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);
    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(5, 10, 7);
    scene.add(dirLight);

    // Masa
    const masaGeo = new THREE.BoxGeometry(20, 1, 10);
    const masaMat = new THREE.MeshStandardMaterial({color: 0x1c8c3a});
    const masa = new THREE.Mesh(masaGeo, masaMat);
    masa.position.y = -0.5;
    scene.add(masa);

    // Top (cue ball)
    const topGeo = new THREE.SphereGeometry(0.5, 32, 32);
    const topMat = new THREE.MeshStandardMaterial({color: 0xffffff});
    const bilardoTopu = new THREE.Mesh(topGeo, topMat);
    bilardoTopu.position.set(0, 0.5, 0);
    scene.add(bilardoTopu);

    // Hız ve yön (2D vektör)
    let velocity = new THREE.Vector2(0, 0);
    let directionAngle = 0; // radyan cinsinden yön

    // Güç kontrolü
    const powerBar = document.getElementById('powerBar');
    const powerIndicator = document.getElementById('powerIndicator');
    let power = 0;
    let powerIncreasing = true;

    // Yön kontrolü
    const directionArrow = document.getElementById('directionArrow');
    function updateDirectionArrow() {
      // directionAngle radyan, dereceye çevir ve 0-100% arası left ayarla
      let deg = THREE.MathUtils.radToDeg(directionAngle);
      // 0 derece sağa bakar, -90 yukarı, 90 aşağı
      // Biz 0 dereceyi yukarı yapalım ve sola-sağa ±90 derece aralığında sınırlayalım
      let degUI = THREE.MathUtils.clamp(deg, -90, 90);
      // UI içinde sola-sağa 0% - 100% (sol - sağ)
      let leftPercent = 50 + (degUI / 90) * 50;
      directionArrow.style.left = leftPercent + '%';
    }
    updateDirectionArrow();

    // Klavye olayları
    window.addEventListener('keydown', (e) => {
      if (e.repeat) return; // basılı tutulunca sürekli olmaması için

      if (e.key === 'ArrowRight') {
        directionAngle -= THREE.MathUtils.degToRad(5);
        if (directionAngle < -Math.PI/2) directionAngle = -Math.PI/2; // -90 derece sınırı
        updateDirectionArrow();
      } else if (e.key === 'ArrowLeft') {
        directionAngle += THREE.MathUtils.degToRad(5);
        if (directionAngle > Math.PI/2) directionAngle = Math.PI/2; // 90 derece sınırı
        updateDirectionArrow();
      } else if (e.key === ' ') {
        // Vuruş
        // Velocity'yi power ve direction ile ayarla
        velocity.x = power * Math.sin(directionAngle) / 10; // /10 ile hız düşürüldü
        velocity.y = power * Math.cos(directionAngle) / 10;
      }
    });

    // Animasyon
    function animate() {
      requestAnimationFrame(animate);

      // Güç animasyonu (0-100 arasında artar azalır)
      if (velocity.length() === 0) { // hareket yoksa güç arttır
        if (powerIncreasing) {
          power += 1;
          if (power >= 100) powerIncreasing = false;
        } else {
          power -= 1;
          if (power <= 0) powerIncreasing = true;
        }
        powerIndicator.style.height = power + '%';
      }

      // Top hareketi
      if (velocity.length() > 0) {
        bilardoTopu.position.x += velocity.x;
        bilardoTopu.position.z += velocity.y;

        // Masa sınırları
        if (bilardoTopu.position.x > 9.5) {
          bilardoTopu.position.x = 9.5;
          velocity.x = -velocity.x * 0.7; // sektirme efekti
        }
        if (bilardoTopu.position.x < -9.5) {
          bilardoTopu.position.x = -9.5;
          velocity.x = -velocity.x * 0.7;
        }
        if (bilardoTopu.position.z > 4.5) {
          bilardoTopu.position.z = 4.5;
          velocity.y = -velocity.y * 0.7;
        }
        if (bilardoTopu.position.z < -4.5) {
          bilardoTopu.position.z = -4.5;
          velocity.y = -velocity.y * 0.7;
        }

        // Sürtünme (yavaşlama)
        velocity.multiplyScalar(0.95);

        if (velocity.length() < 0.01) {
          velocity.set(0,0,0);
        }
      }

      renderer.render(scene, camera);
    }
    animate();

    // Pencere yeniden boyutlandırıldığında ayarla
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
